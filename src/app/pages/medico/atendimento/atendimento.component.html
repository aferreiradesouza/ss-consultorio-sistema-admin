<nb-card [nbSpinner]="isLoading" nbSpinnerStatus="primary">
    <nb-card-header class="d-flex vertical-align">
        <div class="mr-auto title">
            {{consulta?.usuario?.nome || '-'}}
        </div>
        <div class="ml-auto d-flex">
            <div class="mr-4">
                <button type="submit" [disabled]="disabledIniciarAtendimento" (click)="iniciarAtendimento()" nbButton
                    status="primary">Iniciar atendimento</button>
            </div>
            <div class="tempo align-center">
                {{tempo}}
            </div>
        </div>
    </nb-card-header>
    <nb-card-body>
        <div class="row">
            <div class="col-sm-4">
                <nb-card class="mb-0">
                    <nb-card-body class="p-0">
                        <nb-list>
                            <nb-list-item (click)="setTabActive(item.value)" class="subMenu" *ngFor="let item of menu"
                                [ngClass]="{'active' : tabActive === item.value}">
                                {{ item.label }}
                            </nb-list-item>
                        </nb-list>
                    </nb-card-body>
                </nb-card>
            </div>
            <div class="col-sm-8" [formGroup]="form" *ngIf="lista">
                {{form.value | json}}
                <ng-container *ngIf="tabActive === 'anamnese'">
                    <nb-card class="mb-0 group-form" *ngFor="let item of lista">
                        <nb-card-header>{{item.title}}</nb-card-header>
                        <nb-card-body>
                            <nb-list>
                                <nb-list-item *ngFor="let subItem of item.children">
                                    <ngx-input-simple [feedback]="false" [label]="subItem.label" type="text"
                                        [formControlName]="subItem.control" [disabled]="formDisabled">
                                    </ngx-input-simple>
                                </nb-list-item>
                            </nb-list>
                        </nb-card-body>
                    </nb-card>
                </ng-container>
                <ng-container *ngIf="tabActive === 'prescricao'">
                    <nb-card class="mb-0 group-form">
                        <nb-card-body class="p-0 pt-3">
                            <nb-tabset fullWidth>
                                <nb-tab tabTitle="Nova Prescrição" class="p-3">
                                    <div class="mb-3">
                                        <label class="label d-block">Selecione um template</label>
                                        <nb-select formControlName="templatePrescricao" style="min-width: 14rem"
                                            *ngFor="let item of getTemplaterPerFilter(4)" placeholder="Selecione">
                                            <nb-option [value]="item.id">{{item.nome}}</nb-option>
                                        </nb-select>
                                    </div>
                                    <ngx-editor [showButtons]="false" formControlName="prescricao"></ngx-editor>
                                    <div class="d-flex mt-3">
                                        <button type="submit" class="ml-auto" nbButton status="primary"
                                        (click)="salvarDocumento('prescricao')">Salvar</button>
                                    </div>
                                </nb-tab>
                                <nb-tab tabTitle="Prescrições emitidas">
                                    <div class="row" *ngIf="listagemDocumentos.listaPrescricao.length">
                                        <div class="col-12 col-md-6 col-sm-12 col-lg-6 position-relative"
                                            *ngFor="let item of listagemDocumentos.listaPrescricao;let i = index">
                                            <div class="container-documentos mb-4" [innerHtml]="getSanitazer(item)">
                                            </div>
                                            <div class="icon d-flex">
                                                <nb-icon (click)="printPreview('Prescrição', item, 'print')" nbTooltip="Imprimir" nbTooltipStatus="primary" icon="printer-outline" status="primary"></nb-icon>
                                                <nb-icon (click)="printPreview('Prescrição', item, 'preview')" nbTooltip="Visualizar" nbTooltipStatus="success" icon="eye-outline" status="success"></nb-icon>
                                                <nb-icon (click)="excluirDoc(i)" nbTooltip="Excluir" nbTooltipStatus="danger" icon="trash-2-outline" status="danger"></nb-icon>
                                            </div>
                                        </div>
                                    </div>
                                    <div *ngIf="!listagemDocumentos.listaPrescricao.length">
                                        Não há nenhum documento salvo
                                    </div>
                                </nb-tab>
                            </nb-tabset>
                        </nb-card-body>
                    </nb-card>
                </ng-container>
            </div>
        </div>
    </nb-card-body>
</nb-card>